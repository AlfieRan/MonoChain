# 2.2.7 Cycle 7 - Improved Webportal (Mobile Support)

* Improved webportal home page, added new buttons.
* Navigation bar didn't work for mobile.
* Fixed navigation bar for mobile

## Design

### Objectives

Now that basic inter-nodal communication, cryptography and some other essentials are setup for the node software I think it's a good time to work on the webportal a bit more and I also to happen to have noticed that at this point the webportal does not render very well on mobile, so that's a good place to start.

* [ ] Fix the rendering issues on mobile
* [ ] Implement a separate navigation bar on mobile that is easier to use
* [ ] Improve the home page.
* [ ] Add some navigation buttons on the homepage (Inspired by [ethereum.org](https://ethereum.org))

### Usability Features

* Feature 1
* Feature 2

### Key Variables

| Variable Name | Use                                                                                                                         |
| ------------- | --------------------------------------------------------------------------------------------------------------------------- |
| mobile        | A boolean value which tells the navigation component whether to render the mobile or desktop view.                          |
| window        | An object that stores the width and height of the browser window to be used to calculate the value for the mobile variable. |
| breakpoint    | An integer value which when the width of window is less than, the mobile navigation bar is enabled.                         |

### Pseudocode

The code for the rendering issues are mainly just css changes to ensure that as many browser sizes as possible are supported, therefore there's not really any pseudocode to be written.

However for the new navigation bar and the new buttons on the home screen there is some actual code to write.

Starting with the new navigation bar, this will introduce two 'react hooks' that allows the 'mobile' variable referenced in key variables to be generated every time the window changes size. The first one will be called 'useWindowSize()' and will be kept in a separate file to the navigation bar file incase it is useful in other parts of the website later on, and the second hook being a basic one that re-renders any time the window variable referencing the 'useWindowSize()' hook changes.

**The 'useWindowSize()' hook**

```tsx
// useWindowSize Hook
FUNCTION useWindowSize():
  // generate the window size variable
  windowSize = {
    width: 0
    height: 0
  }

  // Handler to call on window resize
  FUNCTION handleResize():
    // Set window width/height to state
    window = {
      width: window.innerWidth,
      height: window.innerHeight,
    }
  END FUNCTION

 RELOAD_ON_CHANGE (window):
    IF (window != "undefined"):
      // Add event listener to call handleResize everytime the window is resized.
      window.addEventListener("resize", handleResize);

      // Call handler right away so state gets updated with initial window size
      handleResize();

      // Remove event listener on cleanup
      RETURN window.removeEventListener("resize", handleResize);
    END IF
  END RELOAD_ON_CHANGE
  
  RETURN windowSize;
END FUNCTION
```

**The mobile navigation bar hook**

```tsx
// initialise the nav bar as desktop
mobile = false

// set the breakpoint as a width of 700 pixels
breakpoint = 700

RELOAD_ON_CHANGE (window.width):
    // reloads any time the window.width changes

    IF (window.width < breakpoint):
      mobile = true
      
    ELSE IF (window.width > breakpoint):
      mobile = false
      
    END IF
END
```

## Development

Most of the development for this cycle was just setup, to get everything I need for this project up and running and building out the structure of the codebase in order to make the actual programming as smooth as possible.

### Outcome

**useWindowSize() Hook**

```tsx
import { useState, useEffect } from "react";

// Hook
export default function useWindowSize() {
  const [windowSize, setWindowSize] = useState<{
    width: undefined | number;
    height: undefined | number;
  }>({
    width: undefined,
    height: undefined,
  });

  // Handler to call on window resize
  function handleResize() {
    // Set window width/height to state
    setWindowSize({
      width: window.innerWidth,
      height: window.innerHeight,
    });
  }

  useEffect(() => {
    // only execute all the code below in client side
    if (typeof window !== "undefined") {
      // Add event listener
      window.addEventListener("resize", handleResize);

      // Call handler right away so state gets updated with initial window size
      handleResize();

      // Remove event listener on cleanup
      return () => window.removeEventListener("resize", handleResize);
    }
  }, []); // Empty array ensures that effect is only run on mount
  return windowSize;
}
```

**Mobile hook**

Since this code is part of the NavBar component, there's a lot more code that isn't relevant here so this only shows the relevant code, but the entire file can be found [here](https://github.com/AlfieRan/MonoChain/blob/8215f151e70625a9f08254186899b2d097bb4bb2/packages/webportal/src/component/NavBar.tsx).

```tsx
const NavBar = () => {
  // there is some other code ran here

  // generate the required constants
  const window = useWindowSize();
  const breakpoint = 700;
  const [mobile, setMobile] = useState<boolean>(true);
  
  // create the hook
  useEffect(() => {
    if ((window.width || 0) < breakpoint) {
      setMobile(true);
    } else if ((window.width || 0) > breakpoint) {
      setMobile(false);
    }
  }, [window.width]);
  
  
  // then moves onto to the code for some other hooks & the actual components
}
```

#### The mobile and desktop rendering splitter

Once again, this code is part of the NavBar component, but since that file is so big and including all of it would make it unclear which parts have been changed, so only relevant sections have been included here.

```tsx
<div hidden={mobile}>
  <Flex css={NavBarCss} justifyContent={"center"}>
    {Links.map((data) => {
      if (data.type === "component") {
        return (
          <Flex flexDir={"column"} key={data.name}>
            <Button
              bg={""}
              my={0}
              mx={LinkMarginAmount}
              p={0}
              _hover={LinkHover}
              _active={LinkHover}
              onClick={() => {
                data.state.change(!data.state.value);
              }}
            >
              <Text
                fontSize={"xl"}
                fontWeight={"normal"}
                h={"full"}
                w={"full"}
                lineHeight={"base"}
                pt={1.5}
              >
                {data.name}
              </Text>
            </Button>
          </Flex>
        );
      } else {
        return (
          <Link
            key={data.name}
            href={data.href}
            mx={LinkMarginAmount}
            isExternal={!!data.external}
            _hover={LinkHover}
          >
            <Text fontSize={"xl"} h={"full"} w={"full"} pt={1.5}>
              {data.name}
            </Text>
          </Link>
        );
      }
    })}
  </Flex>
  {Links.filter((item) => item.type === "component").map((data) => {
    if (data.type === "component") {
      return (
        <Collapse key={data.name} in={data.state.value} dir="top">
          <data.comp />
        </Collapse>
      );
    }
  })}
</div>
<MobileNav hidden={!mobile} />
```

### Challenges

Challenges faced in either/both objectives

## Testing

### Tests

| Test | Instructions | What I expect | What actually happens | Pass/Fail |
| ---- | ------------ | ------------- | --------------------- | --------- |
| 1    |              |               |                       |           |
| 2    |              |               |                       |           |
| 3    |              |               |                       |           |

### Evidence

(Images of tests running/results)
